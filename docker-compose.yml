version: '3.8'

networks:
  my_network:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.1.0/24

services:
  webserver:
    build: .
    ports:
      - "80:80"
    volumes:
      - .:/usr/share/nginx/html
      - ./py/audio_input:/app/audio_input  # Volume condiviso
    restart: unless-stopped
    networks:
      my_network:
        ipv4_address: 192.168.1.100

  app:
    image: python:3.9  # Usa un'immagine Python ufficiale
    volumes:
      - ./py:/app  # Monta la cartella py come /app nel container
      - ./py/audio_input:/app/audio_input  # Volume condiviso mappato dentro ./py/audio_input
    working_dir: /app
    command: ["/bin/sh", "-c", "apt-get update && apt-get install -y ffmpeg && pip install flask-cors elevenlabs ffmpeg flask requests pydub && python3 semplice.py"]
    restart: unless-stopped
    ports:
      - "5000:5000"
    networks:
      my_network:
        ipv4_address: 192.168.1.101

volumes:
  audio_input:
    driver: local
    driver_opts:
      type: none
      device: ./py/audio_input
      o: bind
